// Library
import { UseGuards } from '@nestjs/common';
import { Query, Mutation, Resolver, Subscription } from '@nestjs/graphql';
import { PubSub } from 'graphql-subscriptions';

// Internal
import { I{{pascalCase moduleName}} } from '../shared/{{moduleName}}.model';
import { {{pascalCase moduleName}}Service } from '../shared/{{moduleName}}.service';
import { {{pascalCase moduleName}}Guard } from './{{moduleName}}.guard';

const pubSub = new PubSub();

// @UseGuards({{pascalCase moduleName}}Guard)
@Resolver('{{pascalCase moduleName}}')
export class {{pascalCase moduleName}}Resolver {
constructor(private readonly {{moduleName}}Service: {{pascalCase moduleName}}Service) {}

@Query()
async get{{moduleName}}() {
    return await this.{{moduleName}}Service.findAll();
}

@Query('{{moduleName}}')
async findOneById(obj, args, context, info): Promise<I{{pascalCase moduleName}}> {
    const { id } = args;
        return await this.{{moduleName}}Service.findOneById(+id);
    }

    @Mutation('create{{moduleName}}')
    async create(obj, args: I{{pascalCase moduleName}}, context, info): Promise<I{{pascalCase moduleName}}> {
        const created{{pascalCase moduleName}} = await this.{{moduleName}}Service.create(args);
        pubSub.publish('{{moduleName}}Recieved', { {{moduleName}}Recieved: created{{pascalCase moduleName}} });
        return created{{pascalCase moduleName}};
    }

    @Mutation('update{{moduleName}}')
    async update(obj, args: I{{pascalCase moduleName}}, context, info): Promise<I{{pascalCase moduleName}}> {
        const { id } = args;
        const updated{{pascalCase moduleName}} = await this.{{moduleName}}Service.update(id, args);
        pubSub.publish('{{moduleName}}Recieved', { {{moduleName}}Recieved: updated{{pascalCase moduleName}} });
        return updated{{pascalCase moduleName}};
    }

    @Subscription('{{moduleName}}Recieved')
    {{moduleName}}Recieved() {
        return pubSub.asyncIterator('{{moduleName}}Recieved');
    }
}